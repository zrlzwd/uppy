




<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Uppy Server — Uppy File Uploader</title>
    <meta charset="utf-8">
    <meta name="title" content="Uppy Server — Uppy File Uploader">
    <meta name="description" content="Sleek, modular file uploader that integrates seamlessly with any framework. It fetches files from local disk, Google Drive, Dropbox, Instagram, remote URLs, cameras and other exciting locations, and then uploads them to the final destination. It’s fast, easy to use and let&#39;s you worry about more important problems than building a file uploader.
">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@uppy_io">
    <meta name="twitter:creator" content="@uppy_io">
    <meta property="og:url" content="https://uppy.io/docs/server/index.html">
    <meta property="og:title" content="Uppy Server — Uppy File Uploader">
    <meta name="twitter:title" content="Uppy Server — Uppy File Uploader">
    <meta name="twitter:description" content="Sleek, modular file uploader that integrates seamlessly with any framework. It fetches files from local disk, Google Drive, Dropbox, Instagram, remote URLs, cameras and other exciting locations, and then uploads them to the final destination. It’s fast, easy to use and let's you worry about more important problems than building a file uploader.
">
    <meta property="og:image" content="http://uppy.io/images/uppy-social.jpg">
    <meta name="twitter:image" content="http://uppy.io/images/uppy-social.jpg">

    <link rel="icon" href="/images/logos/uppy-dog-head-arrow.png" type="image/x-icon">
    <link rel="alternate" type="application/rss+xml" title="Uppy File Uploader" href="/atom.xml">

    <link href="//fonts.googleapis.com/css?family=Source+Sans+Pro:400,600|Roboto+Mono" rel="stylesheet">
    <link href="//fonts.googleapis.com/css?family=Poiret+One:400" rel="stylesheet">
    <script>
      window.PAGE_TYPE = "docs"
    </script>
    <link rel="stylesheet" href="/css/main.css">
  </head>
  <body class="page-inner">
    <div class="page">
      <header id="header" class="MainHeader js-MainHeader">
        <button class="MainHeader-menuBtn js-MenuBtn"></button>

        <a id="logo" class="MainLogo" href="/">
          <img class="MainLogo-img" src="/images/logos/uppy-dog-head-arrow.svg">
          <span class="MainLogo-text">Uppy File Uploader</span>
        </a>

        <nav>
          <ul id="nav" class="MainMenu">
            <!-- @todo uncomment search input when we get our own swifttype -->
<!-- <li>
  <form id="search-form" class="MainMenu-search">
    <input type="text" id="search-query" class="MainMenu-searchQuery st-default-search-input">
  </form>
</li> -->
<!--li><a href="/guide/" class="nav-link">Guide</a></li-->
<li><a href="/docs/" class="nav-link current">Docs</a></li>
<li><a href="/examples/dashboard/" class="nav-link">Examples</a></li>
<!--li><a href="/stats/" class="nav-link">Stats</a></li-->
<li><a href="/blog/" class="nav-link">Blog</a></li>
<li><a href="https://github.com/transloadit/uppy" class="nav-link">Github</a></li>

          </ul>
        </nav>

        <a href="https://github.com/transloadit/uppy" class="github-corner" aria-label="View source on Github"><svg width="67" height="67" viewBox="0 0 250 250" style="fill:#e02177; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
      </header>

      <main class="MainContent js-MainContent" id="main">
        
          
    
<div class="Sidebar js-Sidebar">
  <ul class="main-menu">
    <!-- @todo uncomment search input when we get our own swifttype -->
<!-- <li>
  <form id="search-form" class="MainMenu-search">
    <input type="text" id="search-query" class="MainMenu-searchQuery st-default-search-input">
  </form>
</li> -->
<!--li><a href="/guide/" class="nav-link">Guide</a></li-->
<li><a href="/docs/" class="nav-link current">Docs</a></li>
<li><a href="/examples/dashboard/" class="nav-link">Examples</a></li>
<!--li><a href="/stats/" class="nav-link">Stats</a></li-->
<li><a href="/blog/" class="nav-link">Blog</a></li>
<li><a href="https://github.com/transloadit/uppy" class="nav-link">Github</a></li>

  </ul>
  <div class="list">
    <h2>
      
        <a href="/docs">Docs</a>
      
    </h2>
    <ul class="menu-root">
      
        
        
        
        
          <li>
            <a href="/docs/" class="sidebar-link">Getting Started</a>
          </li>
        
      
        
        
        
        
          <li>
            <a href="/docs/uppy/" class="sidebar-link">Uppy</a>
          </li>
        
      
        
        
        
        
          <li>
            <a href="/docs/server/" class="sidebar-link current">Uppy Server</a>
          </li>
        
      
        
        
        
        
          <li>
            <a href="/docs/stores/" class="sidebar-link">Custom Stores</a>
          </li>
        
      
        
        
        
        
          <li>
            <a href="/docs/contributing.html" class="sidebar-link">Contributing</a>
          </li>
        
      
        
        
        
        
          <li>
            <a href="/docs/stats/" class="sidebar-link">Stats</a>
          </li>
        
      
        
        
        
        
          <li>
            
              <h3><a href="/docs/plugins/">Plugins</a></h3>
            
          </li>
          <li>
            <a href="/docs/plugins/" class="sidebar-link">List & Common Options</a>
          </li>
        
      
        
        
        
        
          <li>
            <a href="/docs/writing-plugins/" class="sidebar-link">Writing Plugins</a>
          </li>
        
      
        
        
        
        
          <li>
            
              <h3>Local Sources</h3>
            
          </li>
          <li>
            <a href="/docs/dashboard/" class="sidebar-link">Dashboard</a>
          </li>
        
      
        
        
        
        
          <li>
            <a href="/docs/drag-drop/" class="sidebar-link">Drag & Drop</a>
          </li>
        
      
        
        
        
        
          <li>
            <a href="/docs/file-input/" class="sidebar-link">File Input</a>
          </li>
        
      
        
        
        
        
          <li>
            <a href="/docs/webcam/" class="sidebar-link">Webcam</a>
          </li>
        
      
        
        
        
        
          <li>
            
              <h3><a href="/docs/providers/">Remote Providers</a></h3>
            
          </li>
          <li>
            <a href="/docs/providers/" class="sidebar-link">Provider Plugins</a>
          </li>
        
      
        
        
        
        
          <li>
            <a href="/docs/dropbox/" class="sidebar-link">Dropbox</a>
          </li>
        
      
        
        
        
        
          <li>
            <a href="/docs/google-drive/" class="sidebar-link">Google Drive</a>
          </li>
        
      
        
        
        
        
          <li>
            <a href="/docs/instagram/" class="sidebar-link">Instagram</a>
          </li>
        
      
        
        
        
        
          <li>
            <a href="/docs/url/" class="sidebar-link">Import From URL</a>
          </li>
        
      
        
        
        
        
          <li>
            
              <h3>Uploaders</h3>
            
          </li>
          <li>
            <a href="/docs/tus/" class="sidebar-link">Tus</a>
          </li>
        
      
        
        
        
        
          <li>
            <a href="/docs/xhr-upload/" class="sidebar-link">XHR Upload</a>
          </li>
        
      
        
        
        
        
          <li>
            <a href="/docs/aws-s3/" class="sidebar-link">AWS S3</a>
          </li>
        
      
        
        
        
        
          <li>
            <a href="/docs/aws-s3-multipart/" class="sidebar-link">AWS S3 Multipart</a>
          </li>
        
      
        
        
        
        
          <li>
            
              <h3>UI Elements</h3>
            
          </li>
          <li>
            <a href="/docs/status-bar/" class="sidebar-link">Status Bar</a>
          </li>
        
      
        
        
        
        
          <li>
            <a href="/docs/progress-bar/" class="sidebar-link">Progress Bar</a>
          </li>
        
      
        
        
        
        
          <li>
            <a href="/docs/informer/" class="sidebar-link">Informer</a>
          </li>
        
      
        
        
        
        
          <li>
            
              <h3>File Processing</h3>
            
          </li>
          <li>
            <a href="/docs/transloadit/" class="sidebar-link">Transloadit</a>
          </li>
        
      
        
        
        
        
          <li>
            
              <h3>Miscellaneous</h3>
            
          </li>
          <li>
            <a href="/docs/form/" class="sidebar-link">Form</a>
          </li>
        
      
        
        
        
        
          <li>
            <a href="/docs/golden-retriever/" class="sidebar-link">Golden Retriever</a>
          </li>
        
      
        
        
        
        
          <li>
            
              <h3><a href="/docs/react/">React Components</a></h3>
            
          </li>
          <li>
            <a href="/docs/react/" class="sidebar-link">Introduction</a>
          </li>
        
      
        
        
        
        
          <li>
            <a href="/docs/react/status-bar/" class="sidebar-link">&lt;StatusBar /></a>
          </li>
        
      
        
        
        
        
          <li>
            <a href="/docs/react/drag-drop/" class="sidebar-link">&lt;DragDrop /></a>
          </li>
        
      
        
        
        
        
          <li>
            <a href="/docs/react/progress-bar/" class="sidebar-link">&lt;ProgressBar /></a>
          </li>
        
      
        
        
        
        
          <li>
            <a href="/docs/react/dashboard/" class="sidebar-link">&lt;Dashboard /></a>
          </li>
        
      
        
        
        
        
          <li>
            <a href="/docs/react/dashboard-modal/" class="sidebar-link">&lt;DashboardModal /></a>
          </li>
        
      
        
        
        
        
          <li>
            <a href="/docs/redux.html" class="sidebar-link">Redux</a>
          </li>
        
      
    </ul>
    <ul class="Social">
  <li><a href="https://twitter.com/uppy_io" class="twitter-follow-button" data-show-count="false" data-dnt="true">Follow @uppy_io</a></li>
  <li><iframe src="https://ghbtns.com/github-btn.html?user=transloadit&repo=uppy&type=watch&count=true"
allowtransparency="true" frameborder="0" scrolling="0" width="100" height="20"></iframe></li>
  <!-- to regenerate you can use this link: https://img.shields.io/badge/community-forum-d8006a.svg -->
  <li><a href="https://community.transloadit.com/c/uppy"><img src="/images/community-forum-d8006a.svg" /> </a></li>
  <li class="BuildBadge">
   <span class="wrapper">
     <a href="https://travis-ci.org/transloadit/uppy"><img src="https://travis-ci.org/transloadit/uppy.svg?branch=master" alt="Build Status"></a>
   </span>
  </li>
  <li class="SauceBadge">
   <span class="wrapper">
     <a href="https://saucelabs.com/u/transloadit-uppy">
       <img src="https://saucelabs.com/buildstatus/transloadit-uppy" alt="Sauce Test Status"/>
     </a>
   </span>
  </li>
</ul>

  </div>
</div>


<div class="Content js-Content docs with-sidebar">
    <h1>Uppy Server</h1>
    <p>Drag and drop, webcam, basic file manipulation (adding metadata, for example) and uploading via tus-resumable uploads or XHR/Multipart are all possible using just the Uppy client module.</p>
<p>However, if you add <a href="https://github.com/transloadit/uppy-server" target="_blank" rel="noopener">Uppy Server</a> to the mix, your users will be able to select files from remote sources, such as Instagram, Google Drive and Dropbox, bypassing the client (so a 5 GB video isn’t eating into your users’ data plans), and then uploaded to the final destination. Files are removed from Uppy Server after an upload is complete, or after a reasonable timeout. Access tokens also don’t stick around for long, for security reasons.</p>
<p>Uppy Server handles the server-to-server communication between your server and file storage providers such as Google Drive, Dropbox, Instagram, etc.</p>
<h2 id="Supported-providers"><a href="#Supported-providers" class="headerlink" title="Supported providers"></a>Supported providers</h2><p>As of now, Uppy Server is integrated to work with:</p>
<ul>
<li>Google Drive</li>
<li>Dropbox</li>
<li>Instagram</li>
<li>Remote URLs</li>
<li>Amazon S3</li>
</ul>
<h2 id="Installation"><a href="#Installation" class="headerlink" title="Installation"></a>Installation</h2><figure class="highlight bash"><table><tr><td class="code"><pre>npm install uppy-server
</pre></td></tr></table></figure>
<h2 id="Usage"><a href="#Usage" class="headerlink" title="Usage"></a>Usage</h2><p>Uppy Server may either be used as a pluggable express app, which you plug into your already existing server, or it may simply be run as a standalone server:</p>
<h3 id="Plugging-into-an-already-existing-server"><a href="#Plugging-into-an-already-existing-server" class="headerlink" title="Plugging into an already existing server"></a>Plugging into an already existing server</h3><p>To plug Uppy Server into an existing server, simply call on its <code>.app</code> method, passing in an <a href="#Options">options</a> object as a parameter.</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre>
<span class="token keyword">var</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> bodyParser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'body-parser'</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> session <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express-session'</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> uppy <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'uppy-server'</span><span class="token punctuation">)</span>

<span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>bodyParser<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">session</span><span class="token punctuation">(</span><span class="token punctuation">{</span>secret<span class="token punctuation">:</span> <span class="token string">'some secrety secret'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">...</span>
<span class="token comment">// be sure to place this anywhere after app.use(bodyParser.json()) and app.use(session({...})</span>
<span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>
  providerOptions<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    google<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      key<span class="token punctuation">:</span> <span class="token string">'GOOGLE_KEY'</span><span class="token punctuation">,</span>
      secret<span class="token punctuation">:</span> <span class="token string">'GOOGLE_SECRET'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  server<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    host<span class="token punctuation">:</span> <span class="token string">'localhost:3020'</span><span class="token punctuation">,</span>
    protocol<span class="token punctuation">:</span> <span class="token string">'http'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  filePath<span class="token punctuation">:</span> <span class="token string">'/path/to/folder/'</span>
<span class="token punctuation">}</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>uppy<span class="token punctuation">.</span><span class="token function">app</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre></td></tr></table></figure>
<p>See <a href="#Options">Options</a> for valid configuration options.</p>
<p>To enable Uppy Socket for realtime upload progress, you can call the <code>socket</code> method, like so:</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="token operator">...</span>
<span class="token keyword">var</span> server <span class="token operator">=</span> app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token constant">PORT</span><span class="token punctuation">)</span>

uppy<span class="token punctuation">.</span><span class="token function">socket</span><span class="token punctuation">(</span>server<span class="token punctuation">,</span> options<span class="token punctuation">)</span>
</pre></td></tr></table></figure>
<p>This takes your <code>server</code> instance and your Uppy <a href="#Options">Options</a> as parameters.</p>
<h3 id="Running-as-a-standalone-server"><a href="#Running-as-a-standalone-server" class="headerlink" title="Running as a standalone server"></a>Running as a standalone server</h3><blockquote>
<p>Please ensure that the required environment variables are set before running/using Uppy Server as a standalone server. See <a href="#Configure-Standalone">Configure Standalone</a> for the variables required.</p>
</blockquote>
<p>Set environment variables first:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre>export UPPYSERVER_SECRET="shh!Issa Secret!"
export UPPYSERVER_DOMAIN="YOUR SERVER DOMAIN"
export UPPYSERVER_DATADIR="PATH/TO/DOWNLOAD/DIRECTORY"
</pre></td></tr></table></figure>
<p>And then run:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre>uppy-server
</pre></td></tr></table></figure>
<p>If you cloned the repo from GitHub and want to run it as a standalone server, you may also run the following command from within its directory:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre>npm start
</pre></td></tr></table></figure>
<p>You can also pass in the path to your JSON config file, like so:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre>uppy-server --config /path/to/uppyconf.json
</pre></td></tr></table></figure>
<p>or</p>
<figure class="highlight bash"><table><tr><td class="code"><pre>npm start -- --config /path/to/uppyconf.json
</pre></td></tr></table></figure>
<p>Please see <a href="#Options">Options</a> for possible options.</p>
<h4 id="Configuring-a-standalone-server"><a href="#Configuring-a-standalone-server" class="headerlink" title="Configuring a standalone server"></a>Configuring a standalone server</h4><p>To run Uppy Server as a standalone server, you are required to set your Uppy <a href="#Options">Options</a> via environment variables:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre>####### Mandatory variables ###########

# any long set of random characters for the server session
export UPPYSERVER_SECRET="shh!Issa Secret!"
# corresponds to the server.host option
export UPPYSERVER_DOMAIN="YOUR SERVER DOMAIN"
# corresponds to the filePath option
export UPPYSERVER_DATADIR="PATH/TO/DOWNLOAD/DIRECTORY"

###### Optional variables ##########

# corresponds to the server.protocol option, defaults to http
export UPPYSERVER_PROTOCOL="YOUR SERVER PROTOCOL"
# the port on which to start the server, defaults to 3020
export UPPYSERVER_PORT="YOUR SERVER PORT"
# corresponds to the server.port option, defaults to ''
export UPPYSERVER_PATH="/SERVER/PATH/TO/WHERE/UPPY-SERVER/LIVES"

# use this in place of UPPYSERVER_PATH if the server path should not be
# handled by the express.js app, but maybe by an external server configuration
# instead (e.g Nginx).
export UPPYSERVER_IMPLICIT_PATH="/SERVER/PATH/TO/WHERE/UPPY/SERVER/LIVES"

# comma-separated client hosts to whitlelist by the server
# if not specified, the server would allow any host
export UPPY_ENDPOINTS="localhost:3452,uppy.io"

# corresponds to the redisUrl option
# this also enables Redis session storage if set
export UPPYSERVER_REDIS_URL="REDIS URL"

# to enable Dropbox
export UPPYSERVER_DROPBOX_KEY="YOUR DROPBOX KEY"
export UPPYSERVER_DROPBOX_SECRET="YOUR DROPBOX SECRET"

# to enable Google Drive
export UPPYSERVER_GOOGLE_KEY="YOUR GOOGLE KEY"
export UPPYSERVER_GOOGLE_SECRET="YOUR GOOGLE SECRET"

# to enable Instagram
export UPPYSERVER_INSTAGRAM_KEY="YOUR INSTAGRAM KEY"
export UPPYSERVER_INSTAGRAM_SECRET="YOUR INSTAGRAM SECRET"

# to enable S3
export UPPYSERVER_AWS_KEY="YOUR AWS KEY"
export UPPYSERVER_AWS_SECRET="YOUR AWS SECRET"
export UPPYSERVER_AWS_BUCKET="YOUR AWS S3 BUCKET"
export UPPYSERVER_AWS_REGION="AWS REGION"

# corresponds to the server.oauthDomain option
export UPPYSERVER_OAUTH_DOMAIN="sub.domain.com"
# corresponds to the server.validHosts option
export UPPYSERVER_DOMAINS="sub1.domain.com,sub2.domain.com,sub3.domain.com"

# corresponds to the sendSelfEndpoint option
export UPPYSERVER_SELF_ENDPOINT="THIS SHOULD BE SAME AS YOUR DOMAIN + PATH"

# comma-separated URLs
# corresponds to the uploadUrls option
export UPPYSERVER_UPLOAD_URLS="http://master.tus.io/files/,https://master.tus.io/files/"
</pre></td></tr></table></figure>
<p>See <a href="https://github.com/transloadit/uppy-server/blob/master/env.example.sh" target="_blank" rel="noopener">env.example.sh</a> for an example configuration script.</p>
<h3 id="Options"><a href="#Options" class="headerlink" title="Options"></a>Options</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="token punctuation">{</span>
  providerOptions<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    google<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      key<span class="token punctuation">:</span> <span class="token string">"***"</span><span class="token punctuation">,</span>
      secret<span class="token punctuation">:</span> <span class="token string">"***"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    dropbox<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      key<span class="token punctuation">:</span> <span class="token string">"***"</span><span class="token punctuation">,</span>
      secret<span class="token punctuation">:</span> <span class="token string">"***"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    instagram<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      key<span class="token punctuation">:</span> <span class="token string">"***"</span><span class="token punctuation">,</span>
      secret<span class="token punctuation">:</span> <span class="token string">"***"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    s3<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      getKey<span class="token punctuation">:</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> filename<span class="token punctuation">)</span> <span class="token operator">=></span> filename<span class="token punctuation">,</span>
      key<span class="token punctuation">:</span> <span class="token string">"***"</span><span class="token punctuation">,</span>
      secret<span class="token punctuation">:</span> <span class="token string">"***"</span><span class="token punctuation">,</span>
      bucket<span class="token punctuation">:</span> <span class="token string">"bucket-name"</span><span class="token punctuation">,</span>
      region<span class="token punctuation">:</span> <span class="token string">"us-east-1"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  server<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    host<span class="token punctuation">:</span> <span class="token string">"localhost:3020"</span><span class="token punctuation">,</span> <span class="token comment">// or yourdomain.com</span>
    protocol<span class="token punctuation">:</span> <span class="token string">"http"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  filePath<span class="token punctuation">:</span> <span class="token string">"path/to/download/folder"</span><span class="token punctuation">,</span>
  sendSelfEndpoint<span class="token punctuation">:</span> <span class="token string">"localhost:3020"</span><span class="token punctuation">,</span>
  secret<span class="token punctuation">:</span> <span class="token string">'mysecret'</span><span class="token punctuation">,</span>
  uploadUrls<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'https://myuploadurl.com'</span><span class="token punctuation">,</span> <span class="token string">'http://myuploadurl2.com'</span><span class="token punctuation">]</span>
  debug<span class="token punctuation">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span>
</pre></td></tr></table></figure>
<ol>
<li><p><strong>filePath(required)</strong> - Full path to the directory to which provider files would be downloaded temporarily.</p>
</li>
<li><p><strong>redisUrl(optional)</strong> - URL to running Redis server. If this is set, the state of uploads would be stored temporarily. This helps for resumed uploads after a browser crash from the client. The stored upload would be sent back to the client on reconnection.</p>
</li>
<li><p><strong>providerOptions(optional)</strong> - An object containing credentials (<code>key</code> and <code>secret</code>) for each provider you would like to enable. Please see <a href="#Supported-Providers">the list of supported providers</a>.</p>
</li>
<li><p><strong>server(optional)</strong> - An object with details, mainly used to carry out oauth authentication from any of the enabled providers above. Though it is optional, it is required if you would be enabling any of the supported providers. The following are the server options you may set:</p>
<ul>
<li>protocol - <code>http | https</code></li>
<li>host(required) - your server host (e.g localhost:3020, mydomain.com)</li>
<li>path - the server path to where the Uppy app is sitting (e.g if Uppy Server is at <code>mydomain.com/uppy</code>, then the path would be <code>/uppy</code>).</li>
<li>oauthDomain - if you have multiple instances of Uppy Server with different (and perhaps dynamic) subdomains, you can set a master domain (e.g <code>sub1.mydomain.com</code>) to handle your oauth authentication for you. This would then redirect to the slave subdomain with the required credentials on completion.</li>
<li>validHosts - if you are setting a master <code>oauthDomain</code>, you need to set a list of valid hosts, so the master oauth handler can validate the host of the Uppy instance requesting the authentication. This is basically a list of valid domains running your Uppy Server instances. The list may also contain regex patterns. e.g <code>[&#39;sub2.mydomain.com&#39;, &#39;sub3.mydomain.com&#39;, &#39;(\\w+).mydomain.com&#39;]</code></li>
</ul>
</li>
<li><p><strong>sendSelfEndpoint(optional)</strong> - This is basically the same as the <code>server.host + server.path</code> attributes. The major reason for this attribute is that, when set, it adds the value as the <code>i-am</code> header of every request response.</p>
</li>
<li><p><strong>customProviders(optional)</strong> - This option enables you to add custom providers along with the already supported providers. See <a href="#Adding-Custom-Providers">Adding Custom Providers</a> for more information.</p>
</li>
<li><p><strong>uploadUrls(optional)</strong> - An array of URLs (full paths). If specified, Uppy Server will only accept uploads to these URLs (useful when you want to make sure an Uppy Server instance is only allowed to upload to your servers, for example).</p>
</li>
<li><p><strong>secret(required)</strong> - A secret string which Uppy Server uses to generate authorization tokens.</p>
</li>
<li><p><strong>debug(optional)</strong> - A boolean flag to tell Uppy Server whether or not to log useful debug information while running.</p>
</li>
</ol>
<h3 id="S3-options"><a href="#S3-options" class="headerlink" title="S3 options"></a>S3 options</h3><p>The S3 uploader has some options in addition to the ones necessary for authentication.</p>
<h4 id="s3-getKey-req-filename"><a href="#s3-getKey-req-filename" class="headerlink" title="s3.getKey(req, filename)"></a><code>s3.getKey(req, filename)</code></h4><p>Get the key name for a file. The key is the file path to which the file will be uploaded in your bucket. This option should be a function receiving two arguments: <code>req</code>, the HTTP request, and the original <code>filename</code> of the uploaded file. It should return a string <code>key</code>. The <code>req</code> parameter can be used to upload to a user-specific folder in your bucket, for example:</p>
<figure class="highlight js"><table><tr><td class="code"><pre>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>authenticationMiddleware<span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>uppy<span class="token punctuation">.</span><span class="token function">app</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  s3<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    getKey<span class="token punctuation">:</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> filename<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>req<span class="token punctuation">.</span>user<span class="token punctuation">.</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>filename<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">,</span>
    <span class="token comment">/* auth options */</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre></td></tr></table></figure>
<p>The default value simply returns <code>filename</code>, so all files will be uploaded to the root of the bucket as their original file name.</p>
<h3 id="Running-in-Kubernetes"><a href="#Running-in-Kubernetes" class="headerlink" title="Running in Kubernetes"></a>Running in Kubernetes</h3><p>We have <a href="https://github.com/transloadit/uppy-server/blob/master/KUBERNETES.md" target="_blank" rel="noopener">a detailed guide on running Uppy Server in Kubernetes</a> for you, that’s how we currently run our example server at <a href="http://server.uppy.io" target="_blank" rel="noopener">http://server.uppy.io</a>.</p>
<h3 id="Adding-custom-providers"><a href="#Adding-custom-providers" class="headerlink" title="Adding custom providers"></a>Adding custom providers</h3><p>As of now, Uppy Server supports <strong>Google Drive</strong>, <strong>Dropbox</strong>, <strong>Instagram</strong>, and <strong>URL</strong> (remote urls) out of the box, but you may also choose to add your own custom providers. You can do this by passing the <code>customProviders</code> option when calling the Uppy <code>app</code> method. The custom provider is expected to support Oauth 1 or 2 for authentication/authorization.</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>
    customProviders<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        myprovidername<span class="token punctuation">:</span> <span class="token punctuation">{</span>
            config<span class="token punctuation">:</span> <span class="token punctuation">{</span>
                authorize_url<span class="token punctuation">:</span> <span class="token string">"https://mywebsite.com/authorize"</span><span class="token punctuation">,</span>
                access_url<span class="token punctuation">:</span> <span class="token string">"https://mywebsite.com/token"</span><span class="token punctuation">,</span>
                oauth<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
                key<span class="token punctuation">:</span> <span class="token string">"***"</span><span class="token punctuation">,</span>
                secret<span class="token punctuation">:</span> <span class="token string">"**"</span><span class="token punctuation">,</span>
                scope<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"read"</span><span class="token punctuation">,</span> <span class="token string">"write"</span><span class="token punctuation">]</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            module<span class="token punctuation">:</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'/path/to/provider/module'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

uppy<span class="token punctuation">.</span><span class="token function">app</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span>
</pre></td></tr></table></figure>
<p>The <code>customProviders</code> option should be an object containing each custom provider. Each custom provider would, in turn, be an object with two keys, <code>config</code> and <code>module</code>. The <code>config</code> option would contain Oauth API settings, while the <code>module</code> would point to the provider module.</p>
<p>To work well with Uppy Server, the <strong>Module</strong> must be a class with the following methods.</p>
<ol>
<li><code>list (options, done)</code> - lists JSON data of user files (e.g. list of all the files in a particular directory).<ul>
<li><code>options</code> - is an object containing the following attributes<ul>
<li>token - authorization token (retrieved from oauth process) to send along with your request</li>
<li>directory - the <code>id/name</code> of the directory from which data is to be retrieved. This may be ignored if it doesn’t apply to your provider</li>
<li>query - expressjs query params object received by the server (just in case there is some data you need in there).</li>
</ul>
</li>
<li><code>done (err, response, body)</code> - the callback that should be called when the request to your provider is made. As the signature indicates, the following data should be passed along to the callback <code>err</code>, <code>response</code>, and <code>body</code>.</li>
</ul>
</li>
<li><code>download (options, onData, onResponse)</code> - downloads a particular file from the provider.<ul>
<li><code>options</code> - is an object containing the following attributes:<ul>
<li>token - authorization token (retrieved from oauth process) to send along with your request.</li>
<li>id - ID of the file being downloaded.</li>
</ul>
</li>
<li><code>onData (chunk)</code> - a callback that should be called with each data chunk received on download. This is useful if the size of the downloaded file can be pre-determined. This would allow for pipelined upload of the file (to the desired destination), while the download is still going on.</li>
<li><code>onResponse (response)</code> - if the size of the downloaded file can not be pre-determined by Uppy Server, then this callback should be called in place of the <code>onData</code> callback. This callback would be called after the download is done, and would take the downloaded data (response) as the argument.</li>
</ul>
</li>
</ol>
<h2 id="Development"><a href="#Development" class="headerlink" title="Development"></a>Development</h2><p>1. To set up Uppy Server for local development, please clone the repo and install, like so:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre>git clone https://github.com/transloadit/uppy-server && cd uppy-server && npm install
</pre></td></tr></table></figure>
<p>2. Configure your environment variables by copying the <code>env.example.sh</code> file to <code>env.sh</code> and edit it to its correct values.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre>cp env.example.sh env.sh
$EDITOR env.sh
</pre></td></tr></table></figure>
<p>3. To start the server, simply run:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre>npm run start:dev
</pre></td></tr></table></figure>
<p>This would get the Uppy Server running on <code>http://localhost:3020</code>.</p>
<h2 id="Live-example"><a href="#Live-example" class="headerlink" title="Live example"></a>Live example</h2><p>An example server is running at <a href="http://server.uppy.io" target="_blank" rel="noopener">http://server.uppy.io</a>, which is deployed with <a href="https://github.com/transloadit/uppy-server/blob/master/KUBERNETES.md" target="_blank" rel="noopener">Kubernetes</a></p>

    
    <div class="footer">Caught a mistake or want to contribute to the documentation?
       <a href="https://github.com/transloadit/uppy/blob/master/website/src/docs/server.md" rel="noreferrer noopener" target="_blank">Edit/fork this page directly on Github</a>!
    </div>
</div>

        
      </main>

      <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-63083-12', 'uppy.io');
  ga('send', 'pageview');
</script>


      
        <script src="/js/smooth-scroll.min.js"></script>
      
      <script src="/js/common.js"></script>

      <!-- Twitter follow button script -->
      <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

      <!--script src="//ajax.googleapis.com/ajax/libs/webfont/1.6.16/webfont.js"></script>
      <script>
        WebFont.load({
          google: {
            families: ['Source Sans Pro:400,600', 'Roboto Mono', 'Poiret One:400']
          }
        });
      </script-->
    </div>
  </body>
</html>
